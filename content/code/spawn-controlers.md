# Контроллеры спавнов

## Общие принципы

### Приблизительный алгоритм

* {Tt} каждой фракции существ присваивается целое число &ndash; **индекс фракции**;
* {Tt} каждому монстру из фракции присваивается целое число &ndash; **индекс юнита**;
* {T} каждая локация содержит массивы **индексов фракций** и **индексов юнитов**, причём для каждых фракции и монстра число его индексов в массиве может быть разным:
   * {Ex} например, возможен массив вида: [ 1 1 1 1 2 3 3 ], где 1 это индекс зомби, 2 это индекс волколака, 3 индекс некроманта;
* {t} существует глобальная переменная **currentSpawnOwnerPlayer**, в которой хранится игрок-владелец юнитов спавна;
* {t} существует глобальная переменная **currentFractionIndexArray**, в которой хранится текущий массив фракций юнитов;
* {t} существует глобальная переменная **currentUnitIndexArray**, в которой хранится текущий массив индексов юнитов;
* {t} существует глобальная переменная **currentCountOfUnit**, в которой хранится количество юнитов;
* {t} существует глобальная переменная **currentDCountOfUnit**, в которой отклонение количества юнитов;
* {t} существует глобальная переменная **currentSpawnRegion**, в которой хранится текущий регион в котором происходит спавн;
* {Tt} при срабатывании **триггера-инициатора** спавна в глобальные переменные перечисленные выше заносятся соответствующие значения, и запускаются (*run trigger*) **спавн-триггеры** нужного **типа**;
* {Tt} **спавн-триггеры** генерируют юнитов следующим образом:
   * в цикле от 1 до currentCountOfUnit=/-currentDCountOfUnit нужно:
      * из массива текущих индексов фракций, случайным образом выбирается один из элементов (выбор фракции);
      * из массива текущих индексов юнитов, соответсвующего выбранному индексу фракции, случайным образом выбирается один из элементов (выбор юнита);
      * в регионе currentSpawnRegion спавнится юнит, соотвествующий выбранному индексу юнита, в соответствии с правилами типа данного спавн триггера (в рандомной точке области, в центре...) для игрока currentSpawnOwnerPlayer;
      * *возможное время ожидания?*;

### Детализированный алгоритм

* {Trig} Триггер определяющий переменные константы карты:
   * Константы индексов юнитов:
      * формат имени переменной: `const_spawn_index_*имя юнита*`;
      * Комментарии отделают юнитов одной фракции от другой. Пример:
         * ------ Заражённые города ------- ;
         * ... ;
         * ------ Заражённые пригорода ------- ;
         * ... ;
   * Константы верятностей юнитов:
      * формат имени переменной: `const_spawn_index_*имя юнита*`;
      * ;
   * Константы типов спавна:
      * `const_spawn_in_center`: *center*:спавн в центр региона;
      * `const_spawn_in_random`: *random*:спавн в рандомную точку региона;

* {Trig} Триггеры создающие юнита:
   * **Формат имени триггера**: `SpawnCreate*Имя фракции/субфракции*`;
   * **Переменные которые использует данный триггер**:
      * CSpawn_random_type_of_unit &ndash; переменная в которой лежит сгенерированный рандомно тип юнита;
      * CSpawn_array_unit_types &ndash; массив в котором хранятся текущие вероятности индексов типов юнитов спавна, вида [ 1 1 1 1 2 3 3 ]. Имеет размерность 50;
         * CSpawn_min_type_of_unit &ndash; минимальное значение выборки из массива с вероятностями индексов типов юнитов;
         * CSpawn_min_type_of_unit &ndash; максимальное значение выборки из массива с вероятностями индексов типов юнитов;
         * CSpawn_real_length_spawn_array &ndash; реальная длинна массива с типами юнитов спавна;
      * CSpawn_owner_of_unit &ndash; владелец юнитов спавна;
      * CSpawn_spawn_region &ndash; регион для спавна;
      * СSpawn_spawn_type &ndash; тип спавна (в центр региона, в рандомную точку);
      * CSpawn_facing_region &ndash; регион к которому юниты спавна будут повёрнуты;
      * CSpawn_current_group &ndash; группа спавна;
   * **Действия**:
      * **CSpawn_random_type_of_unit** = рандомное число из диапазона (**CSpawn_min_type_of_unit**, **CSpawn_max_type_of_unit**);
         * Замечание, выбирать рандомное число нужно не из диапазона, а из **массива с вероятностями спавна** вида [ 1 1 1 1 2 3 3 ]:
      * Если **CSpawn_random_type_of_unit** = **const_spawn_index_type_of_unit**, то:
         * Если **CSpawn_spawn_type** = **const_spawn_...**, то:
            * В регионе **CSpawn_spawn_region** для игрока **CSpawn_owner_of_unit** спавнится юнит типа **const_spawn_index_type_of_unit**, в соответствии с **const_spawn_...**;
            * Юнит заносится в группу **CSpawn_current_spawn_group**;

## Типы триггеров-инициаторов

## Типы спавн-триггеров

## Зависимость размера спавна от колличества игроков

Можно использовать число игроков (размер группы Survive) для регулирования численности спавнов.
